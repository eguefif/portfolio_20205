gh:https://github.com/eguefif/grb_amateur
link: https://www.grb-amateur.space

# Gamma Ray Burst Platform

This platform allows an amateur astronomer to register, get email notification when a Gamma-Ray Burst is detected by the Fermi satellite and post observations.

The backend is written with FastAPI/Postgres and the Frontend is in Vue.js.

In terms of infrastructure, I have three compute units and a virtual network on Scaleway. I use Docker Swarm to manage three services: Frontend serving, FastAPI backend and alertSys. Alertsys is a python service that monitors Nasa GCN kafka event bus. When a message is received, AlertSys sends an HTTP request to the backend. The backend registers the alert and notifies users. Postgres is hosted on one of the instances. Everything is behind an Nginx. 

The server's ip address is protected by Cloudflare which is used as a reverse proxy.

## Goals

I created this project to learn three skills:
* a simple but complete FastAPI app with: authentication, background job, dependency injection and SqlModel.
* an automated CI/CD with Github Actions, Docker Swarm and Scaleway Cloud.
* Domain name handling and protection with CloudFlare.

## Spotlights

I am particularly proud of the automated CI/CD. I spent quite some time to make it work. Everything is pretty simple but I had trouble with Cloudflare bot filtering. When the CI passes and the docker images are built, there is a Github Action that sends a deploy request to my server. There is a simple FastAPI with minimum authentication that will launch processes to update Docker Swarm services.
Anytime I merge a branch on master, the new version gets automatically deployed on my server.

## Lessons Learned

Thanks to this project, I have a better understanding of my current professional project infrastructure that uses Kubernetes and Google Cloud. I know what tasks, instances and pods represent now.

I learned how to implement a secret-based authentication between the backend and AlertSys. They share a common secret and use timestamp encoding to verify authentication.

Last but not least, I learned about FastAPI. This was a great experience. The simplicity and efficiency of the framework are beautiful. It's easy to add background tasks and dependencies. My project was pretty simple. I chose to organize my app in terms of area (users, alerts, observations). In the book I was reading about FastAPI, they organize in terms of models, services and controllers. Rails organizes the app in terms of models/controllers/views. Django organizes in terms of areas (Apps). I have the feeling that keeping models/controllers and services in one app is what makes more sense. These three components are coupled and I find it easier to have them in one place. I don't have the experience on a big project to know what architecture design is better. This will be my next experimentation.
